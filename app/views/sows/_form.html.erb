<%= form_for(@path) do |f| %>
  <% if @sow.errors.any? %>
    <div id="error_explanation">
      <h2><%= pluralize(@sow.errors.count, "error") %> prohibited this sow from being saved:</h2>

      <ul>
      <% @sow.errors.full_messages.each do |msg| %>
        <li><%= msg %></li>
      <% end %>
      </ul>
    </div>
  <% end %>
 
  <div class="field">
    <%= f.label :product, "Product Name",:id=>"productname" %><br />
    <% ary = Array.new() %>
    <% ary << @sow.product_id %>
    <%= collection_select(:sow, :product_id, Product.find_all_in(ary), :id, :formal_name, {:prompt => 'Please select the product'}, {:class=>'productselect'}) %>
  </div>

   <%= f.fields_for :sow_files do |fi| %>

      <div id="file" >
        <br /><br /><br />
        <p><%= fi.file_field :file %></p>
        <p><%= fi.hidden_field :file_cache %></p><br /><br /><br />
      </div>
   <% end %>

  <div id="payorintel">
    <%= render :partial=>"payorintel",:locals=>{:f=>f,:sow=>@sow} %>
  </div>

  <div id="autointel">
    <%= render :partial=>"autointel",:locals=>{:f=>f,:sow=>@sow} %>
  </div>


 <br> 
  <div class="actions" id = "submitbutton">
    <%= f.submit %>
  </div>
<% end %>


<script>
  $('#productname').tooltip({'trigger':'click hover focus', 'title': 'Please select the product name' });
  $('#casend').tooltip({'trigger':'click hover focus', 'title': 'The date on which we send credit agreement to the client' });
  $('#ca').tooltip({'trigger':'click hover focus', 'title': 'Please check this checkbox if you need sign credit agreement' });
  $('#casigndate').tooltip({'trigger':'click hover focus', 'title': 'The date on which we sign credit agreement' });

  function reset_alllevel() {
    $("#type").hide();
    $("#subtype").hide();
    $("#contingencyperpayor").hide();
    $("#contingencyglobal").hide();
    $("#perhitperpayor").hide();
    $("#perhitglobal").hide();
    $("#score_payment").hide();
    $("#score_charity").hide();
    $("#term").hide();
    $("#file").hide();
    $("#ca_part").hide();
    $("#submitbutton").hide();
    $("#autointel").hide();
    $("#payorintel").hide();
  }


  function reset_sublevel() {
    $("#contingencyperpayor").hide();
    $("#contingencyglobal").hide();
    $("#perhitperpayor").hide();
    $("#perhitglobal").hide();
    $("#score").hide();
    $("#term").hide();
    $("#autointel").hide();
  }

  $(function(){
    $("#cadate").hide();
    reset_alllevel();

    if ($(".productselect  option:selected").text().toLowerCase() == "payorintel" ) {
              $("#payorintel").show();
               
              $("#file").show();
              $("#submitbutton").show();
    } else if (  $(".productselect  option:selected").text().toLowerCase() == "autointel" ) {
              $("#file").show();
              $(".autointel").show();
              $("#submitbutton").show();
    } else if($(".productselect  option:selected").text().toLowerCase() == "charity" ) {
            $("#score_charity").show();
              $("#file").show();
              $("#ca_part").show();
              $("#submitbutton").show();
    } else if(  $(".productselect  option:selected").text().toLowerCase() == "payment") {
              $("#score_payment").show();
              $("#file").show();
              $("#ca_part").show();
              $("#submitbutton").show();

    } else if ($(".productselect  option:selected").text().toLowerCase() == "payment and charity") {
        $("#score_payment").show();
        $("#score_charity").show();
        $("#file").show();
        $("#ca_part").show();
        $("#submitbutton").show();
    }




    $(".productselect").bind("change", function () {
        reset_alllevel();
        if ($(".productselect  option:selected").text().toLowerCase() == "payorintel" ) {
            $("#payorintel").show();
      
            $("#file").show();
            $("#submitbutton").show();
        } else if ( $(".productselect  option:selected").text().toLowerCase() == "autointel" ) {
            $("#autointel").show();
            $("#file").show();
            $("#submitbutton").show();

        } else if($(".productselect  option:selected").text().toLowerCase() == "charity" ) {
            $("#score_charity").show();
            $("#file").show();
            $("#ca_part").show();
            $("#submitbutton").show();
        } else if( $(".productselect  option:selected").text().toLowerCase() == "payment") {
            $("#score_payment").show();
            $("#file").show();
            $("#ca_part").show();
            $("#submitbutton").show();
        } else if( $(".productselect  option:selected").text().toLowerCase() == "payment and charity") {
            $("#score_payment").show();
            $("#score_charity").show();
            $("#file").show();
            $("#ca_part").show();
            $("#submitbutton").show();
        }
    });

   

     $('#new_sow').submit(function() {
      //alert('Handler for .submit() called.');
       $('.stateinput').each( function() {
             //return amount without $
            var isthePrice = $(this).val().replace(/[^\d\.]/, '');
            $(this).val( isthePrice );
       });
    });

     $('#casign').click(function(){
      $("#cadate").slideToggle();
    });

  });

</script>